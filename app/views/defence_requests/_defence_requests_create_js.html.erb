<script>
  $(document).ready(function () {

    $('.no-enter-submit').keypress(function(e){
      if ( e.which == 13 ) {
        e.preventDefault();
        submit_search_request()
      }
    });

    $('.solicitor-search').click(function(e) {
      e.preventDefault();
      submit_search_request();
    });

    var submit_search_request = function () {
      $.ajax({
        type:'POST',
        url:'<%= solicitors_search_defence_requests_path %>',
        cache:false,
        data: { q: $('.search-text-field').val() },
      });
    }

    // Clear solicitor search results on ESC keypress
    $(document).on('keydown', function (event) {
      if ($('.solicitor_results_list *').length > 0 && event.keyCode === 27) {
        $('.solicitor_results_list').empty();
      }
    });


    var own_setup = function () {
      $('#main-form-body').removeClass('hidden')
      $('#search-box').removeClass('hidden');
      $('#solicitor-details').removeClass('hidden');
      $('#defence_request_solicitor_firm').removeAttr("disabled");
      $('#defence_request_solicitor_name').removeAttr("disabled");
      $('#scheme-field').addClass("hidden");
      $('#defence_request_scheme').val("");
      $('#defence_request_scheme').attr("disabled", "disabled");
    }

    var duty_setup = function () {
      $('#main-form-body').removeClass('hidden')
      $('#search-box').addClass('hidden');
      $('#solicitor-details').addClass('hidden');
      $('#defence_request_solicitor_firm').attr("disabled", "disabled");
      $('#defence_request_solicitor_firm').val("");
      $('#defence_request_solicitor_name').attr("disabled", "disabled");
      $('#defence_request_solicitor_name').val("");
      $('#scheme-field').removeClass("hidden")
      $('#defence_request_scheme').removeAttr("disabled");
      $('.solicitor_results_list').html("")
      $('#q').val("")
    }

    var adjust_form_for_request_type = function () {
      var ownSolicitor_checked = ($("input[type='radio']#defence_request_solicitor_type_own:checked").length > 0);
      var dutySolicitor_checked = ($("input[type='radio']#defence_request_solicitor_type_duty:checked").length > 0);
      if (ownSolicitor_checked) {
        own_setup()
        } else if(dutySolicitor_checked) {
        duty_setup()
      }
    }

    $(".solicitor_type_radio").change(adjust_form_for_request_type)
    adjust_form_for_request_type()
  });
</script>
