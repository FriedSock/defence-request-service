<div class="row">
  <h1><%= "#{t(current_user.role)}  #{t('dashboard')}"%></h1>
</div>

<% if policy(:defence_request).create? %>
<div class="row new_defence_request">
  <%= link_to t('new_defence_request'), new_defence_request_path, class: 'btn btn-default' %>
</div>
<% end %>

<% if policy(:defence_request).dashboard_view? %>
  <% if policy(:defence_request).index? %>
    <h3><%= t('new_defence_request') %></h3>
    <div class="row">
      <table class="table table-striped table-bordered new_defence_requests">
        <%= render 'defence_requests_table_head' %>
        <tbody>
          <%= render 'defence_requests_table_body', requests: @new_requests %>
        </tbody>
      </table>
    </div>
  <% end %>

  <h3><%= t('open_defence_request') %></h3>
  <div class="row">
    <table class="table table-striped table-bordered open_defence_requests">
      <%= render 'defence_requests_table_head' %>
      <tbody>
        <%= render 'defence_requests_table_body', requests: @open_requests %>
      </tbody>
    </table>
  </div>
<% end %>

<script>
  $(document).ready(function () {
    setInterval(refreshPartial, <%= Settings.dsds.dashboard_refresh_seconds %>);
  });

  // calls action refreshing the partial
  function refreshPartial() {
    $.ajax({
      url: "defence_requests/refresh_dashboard"
    })
  }
</script>
